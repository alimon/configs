- job:
    name: schneider-openembedded-test-notify
    project-type: freestyle
    defaults: global
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
            linaro:
                - job-build
                - job-cancel
        - build-discarder:
            days-to-keep: 30
            num-to-keep: 30
    disabled: false
    node: master
    concurrent: false
    display-name: 'Schneider OpenEmbedded Test Notify'
    wrappers:
        - timeout:
            timeout: 60
        - timestamps
    builders:
        - shell: |
            #!/bin/bash

            set -ex
            echo "This is a test" > email.body
            echo 'echo "More test" >> email.body' > testscript
            chmod +x testscript
            ls -l
            cat testscript
            pwd
    publishers:
        - postbuildscript:
            generic-script:
                - file-path: './testscript'
                - role: MASTER
                - build-on: SUCCESS
        - email-ext:
            # Send custom email generated in jenkins job
            recipients: 'ralph.siemsen@linaro.org'
            subject: 'Schneider OpenEmbedded Test Notify'
            content-type: text
            body: |
                Before text
                ${FILE,path="email.body"}
                After text
            success: true
            failure: false
        - email:
             recipients: 'ralph.siemsen@linaro.org'
