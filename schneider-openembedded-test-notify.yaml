- job:
    name: schneider-openembedded-test-notify
    project-type: freestyle
    defaults: global
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
                - job-workspace
            linaro:
                - job-build
                - job-cancel
        - build-discarder:
            days-to-keep: 30
            num-to-keep: 30
    disabled: false
    node: master
    concurrent: false
    display-name: 'Schneider OpenEmbedded Test Notify'
    wrappers:
        - timeout:
            timeout: 60
        - timestamps
    builders:
        - shell: |
            #!/bin/bash

            set -ex
            echo "This is a test" > email.body
            echo 'echo "More test" >> email.body' > testscript
            chmod +x testscript
            ls -l
            cat testscript
            pwd
    publishers:
        - postbuildscript:
            builders:
                - role: MASTER
                  build-on:
                      - SUCCESS
                  build-steps:
                      - shell: 'echo "Hello world"'
                      - shell: './testscript'
                      - shell: 'echo JENKINS_HOME $JENKINS_HOME'
                      - shell: 'ls -l /var/jenkins_home || true'
                      - shell: 'find /var/jenkins_home -name cve-rzn1-snarc.txt || true'
                      - shell: 'echo "Goodbye world"'
        - email-ext:
            # Send custom email generated in jenkins job
            recipients: 'ralph.siemsen@linaro.org'
            subject: 'Schneider OpenEmbedded Test Notify'
            content-type: text
            body: |
                Before text
                ${FILE,path="email.body"}
                After text
            success: true
            failure: false
        - email:
             recipients: 'ralph.siemsen@linaro.org'
