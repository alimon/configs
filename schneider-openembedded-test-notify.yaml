- job:
    name: schneider-openembedded-test-notify
    project-type: freestyle
    defaults: global
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
                - job-workspace
            linaro:
                - job-build
                - job-cancel
        - build-discarder:
            days-to-keep: 30
            num-to-keep: 30
    disabled: false
    node: master
    concurrent: false
    display-name: 'Schneider OpenEmbedded Test Notify'
    wrappers:
        - timeout:
            timeout: 60
        - timestamps
    builders:
        - shell: |
            #!/bin/bash

            set -ex
            echo "This is a test" > email.body
            echo 'echo "More test" >> email.body' > testscript
            chmod +x testscript
            ls -l
            cat testscript
            pwd
    publishers:
        - postbuildscript:
            builders:
                - role: MASTER
                  build-on:
                      - SUCCESS
                  build-steps:
                      - shell: |
                          echo "Hello world"
                          ./testscript
                          set
                          echo "Goodbye world"
        - email-ext:
            # Send custom email generated in jenkins job
            recipients: 'ralph.siemsen@linaro.org'
            subject: 'Schneider OpenEmbedded Test Notify'
            content-type: both-html-text
            body: |
                <pre>
                Before text
                ${FILE,path="email.body"}
                After text
                </pre>
                <style>
                .CVE_NEW { background-color: #F88; }
                .CVE_FIX { background-color: #8F8; }
                </style>
                <ul>
                <li class="CVE_FIX">test PASS</li>
                <li class="CVE_NEW"">test FAIL</li>
                </ul>
            success: true
            failure: false
        - email:
             recipients: 'ralph.siemsen@linaro.org'
