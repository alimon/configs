#include tcwg/default.yaml.inc

- job:
    name: tcwg-gnu-builds
    project-type: multijob
    defaults: global
    properties:
      - default-properties
    parameters:
      - string:
          name: release_name
          default: default
          description: 'Release name; default is YYYY.MM-1'
      - choice:
          name: version
          choices:
            - latest-rel
            - master
          description: 'Toolchain version; should match a supported ABE config'
      - bool:
          name: host_x86_64
          default: true
      - bool:
          name: host_aarch64
          default: true
      - bool:
          name: target_aarch64
          default: true
      - bool:
          name: target_armhf
          default: true
      - bool:
          name: verbose
          default: true
          description: 'Whether to be verbose'
      - string:
          name: scripts_branch
          default: tested
          description: 'Scripts revision to use'
    disabled: false
    concurrent: true
    display-name: 'TCWG AAA GNU Builds'
    scm:
      - jenkins-scripts
    wrappers:
      - timeout:
          timeout: 300
      - timestamps
      - ssh-agent-credentials:
          # tcwg-buildslave user id
          users:
            - 'e0958a95-204f-4c14-a66c-5e2be6c5d50a'
      - build-name:
          name: '#${BUILD_NUMBER}-${release_name}'
    builders:
      - shell: |
          #!/bin/bash
          set -euf -o pipefail
          env
      - multijob:
          name: Build
          projects:
            - name: tcwg-dev-build
              alias: host_x86_64-target_aarch64
              enable-condition: "$host_x86_64 && $target_aarch64"
              git-revision: true
              node-label-name: "builder"
              node-label: "tcwg-build && tcwg-x86_64-build"
              predefined-parameters: |
                release_name=$release_name
                version=$version
                target=aarch64-linux-gnu
            - name: tcwg-dev-build
              alias: host_x86_64-target_armhf
              enable-condition: "$host_x86_64 && $target_armhf"
              git-revision: true
              node-label-name: "builder"
              node-label: "tcwg-build && tcwg-x86_64-build"
              predefined-parameters: |
                release_name=$release_name
                version=$version
                target=arm-linux-gnueabihf
            - name: tcwg-dev-build
              alias: host_aarch64-target_aarch64
              enable-condition: "$host_aarch64 && $target_aarch64"
              git-revision: true
              node-label-name: "builder"
              node-label: "tcwg-build && tcwg-armv8_64"
              predefined-parameters: |
                release_name=$release_name
                version=$version
                target=native
            - name: tcwg-dev-build
              alias: host_aarch64-target_armhf
              enable-condition: "$host_aarch64 && $target_armhf"
              git-revision: true
              node-label-name: "builder"
              node-label: "tcwg-build && tcwg-armv8_64"
              predefined-parameters: |
                release_name=$release_name
                version=$version
                target=arm-linux-gnueabihf
      - shell: |
          #!/bin/bash
          set -euf -o pipefail
          env
